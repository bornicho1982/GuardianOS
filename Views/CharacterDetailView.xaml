<UserControl x:Class="GuardianOS.Views.CharacterDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:GuardianOS.Views"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:GuardianOS.Core.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">

    <UserControl.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibility"/>

        <!-- Estilo para Slots de Equipo -->
        <Style x:Key="EquipmentSlotStyle" TargetType="Border">
            <Setter Property="Width" Value="90"/>
            <Setter Property="Height" Value="90"/>
            <Setter Property="Background" Value="#33FFFFFF"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Estilo para Barra de Stats -->
        <Style x:Key="StatBarStyle" TargetType="ProgressBar">
            <Setter Property="Height" Value="6"/>
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="100"/>
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="Foreground" Value="#FFD700"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </UserControl.Resources>

    <!-- Contenedor Principal -->
    <Grid>
        <!-- Fondo con Emblema -->
        <Grid.Background>
            <ImageBrush ImageSource="{Binding Character.EmblemBackgroundUrl}" 
                        Stretch="UniformToFill" 
                        Opacity="0.15"/>
        </Grid.Background>

        <!-- Overlay Oscuro -->
        <Rectangle Fill="#141414" Opacity="0.85"/>

        <!-- Botón Cerrar -->
        <Button Command="{Binding GoBackCommand}"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="24"
                Style="{StaticResource MaterialDesignIconButton}"
                ToolTip="Volver al Dashboard"
                Panel.ZIndex="100">
            <materialDesign:PackIcon Kind="Close" Width="28" Height="28" Foreground="White"/>
        </Button>

        <!-- Layout 3 Columnas -->
        <Grid Margin="40,60,40,40">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <!-- ARMAS -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="ARMAS" FontSize="12" FontWeight="Bold" Foreground="#888888" 
                           Margin="0,0,0,16" HorizontalAlignment="Center"/>

                <!-- Cinética -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding KineticWeapon.Name, FallbackValue='Cinética'}">
                    <Grid>
                        <Image Source="{Binding KineticWeapon.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding KineticWeapon.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="Pistol" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding KineticWeapon, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Energética -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding EnergyWeapon.Name, FallbackValue='Energética'}">
                    <Grid>
                        <Image Source="{Binding EnergyWeapon.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding EnergyWeapon.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="Flash" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding EnergyWeapon, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Destructiva -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding PowerWeapon.Name, FallbackValue='Destructiva'}">
                    <Grid>
                        <Image Source="{Binding PowerWeapon.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding PowerWeapon.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="Sword" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding PowerWeapon, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- INFO CENTRAL -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="{Binding Character.ClassName}" FontSize="48" FontWeight="Bold" 
                           Foreground="White" HorizontalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,32">
                    <TextBlock Text="{Binding Character.Light}" FontSize="32" FontWeight="SemiBold" Foreground="#FFD700"/>
                    <TextBlock Text="✦" FontSize="28" Foreground="#FFD700" Margin="6,0,0,0"/>
                </StackPanel>
                <TextBlock HorizontalAlignment="Center" Margin="0,0,0,40">
                    <Run Text="{Binding Character.RaceName, Mode=OneWay}" Foreground="#AAAAAA"/>
                    <Run Text=" · " Foreground="#555555"/>
                    <Run Text="{Binding Character.GenderName, Mode=OneWay}" Foreground="#AAAAAA"/>
                </TextBlock>

                <!-- Stats -->
                <Border Background="#1A1A1A" CornerRadius="8" Padding="24" Width="300">
                    <StackPanel>
                        <TextBlock Text="ESTADÍSTICAS" FontSize="11" FontWeight="Bold" Foreground="#666666" Margin="0,0,0,16"/>
                        <Grid Margin="0,0,0,12"><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Movilidad" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Mobility, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Mobility, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,0,0,12"><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Resistencia" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Resilience, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Resilience, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,0,0,12"><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Recuperación" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Recovery, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Recovery, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,0,0,12"><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Disciplina" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Discipline, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Discipline, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,0,0,12"><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Intelecto" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Intellect, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Intellect, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid><Grid.ColumnDefinitions><ColumnDefinition Width="100"/><ColumnDefinition Width="*"/><ColumnDefinition Width="30"/></Grid.ColumnDefinitions>
                            <TextBlock Text="Fuerza" Foreground="#AAAAAA" FontSize="12"/>
                            <ProgressBar Grid.Column="1" Value="{Binding Character.Strength, Mode=OneWay, FallbackValue=0}" Style="{StaticResource StatBarStyle}"/>
                            <TextBlock Grid.Column="2" Text="{Binding Character.Strength, FallbackValue=0}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- ARMADURA -->
            <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="ARMADURA" FontSize="12" FontWeight="Bold" Foreground="#888888" 
                           Margin="0,0,0,16" HorizontalAlignment="Center"/>

                <!-- Casco -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding Helmet.Name, FallbackValue='Casco'}">
                    <Grid>
                        <Image Source="{Binding Helmet.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding Helmet.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="HardHat" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding Helmet, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Guanteletes -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding Gauntlets.Name, FallbackValue='Guanteletes'}">
                    <Grid>
                        <Image Source="{Binding Gauntlets.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding Gauntlets.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="HandBackLeft" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding Gauntlets, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Peto -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding ChestArmor.Name, FallbackValue='Peto'}">
                    <Grid>
                        <Image Source="{Binding ChestArmor.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding ChestArmor.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="TshirtCrew" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding ChestArmor, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Grebas -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding LegArmor.Name, FallbackValue='Grebas'}">
                    <Grid>
                        <Image Source="{Binding LegArmor.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding LegArmor.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="ShoePrint" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding LegArmor, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>

                <!-- Objeto de Clase -->
                <Border Style="{StaticResource EquipmentSlotStyle}" ToolTip="{Binding ClassItem.Name, FallbackValue='Objeto de Clase'}">
                    <Grid>
                        <Image Source="{Binding ClassItem.IconUrl}" Stretch="Uniform" Margin="4"/>
                        <Border Background="#CC000000" VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="2" Padding="4,2" Margin="2">
                            <TextBlock Text="{Binding ClassItem.PrimaryStatValue}" FontSize="11" FontWeight="Bold" Foreground="#FFD700"/>
                        </Border>
                        <materialDesign:PackIcon Kind="BookmarkOutline" Width="40" Height="40" Foreground="#444444"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 Visibility="{Binding ClassItem, Converter={StaticResource NullToVisibility}, FallbackValue=Visible}"/>
                    </Grid>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Loading Overlay -->
        <Grid Background="#CC000000" Visibility="{Binding IsLoadingEquipment, Converter={StaticResource BoolToVisibility}, FallbackValue=Collapsed}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <materialDesign:PackIcon Kind="Loading" Width="48" Height="48" Foreground="#F5DC56">
                    <materialDesign:PackIcon.RenderTransform>
                        <RotateTransform CenterX="24" CenterY="24"/>
                    </materialDesign:PackIcon.RenderTransform>
                    <materialDesign:PackIcon.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)" 
                                                     From="0" To="360" Duration="0:0:1" RepeatBehavior="Forever"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </materialDesign:PackIcon.Triggers>
                </materialDesign:PackIcon>
                <TextBlock Text="Cargando equipamiento..." Foreground="White" Margin="0,16,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
