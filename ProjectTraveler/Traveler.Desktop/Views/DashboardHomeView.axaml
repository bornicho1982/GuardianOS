<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Traveler.Desktop.ViewModels"
             xmlns:models="using:Traveler.Core.Models"
             xmlns:asyncImageLoader="using:AsyncImageLoader"
             xmlns:converters="using:Traveler.Desktop.Converters"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="Traveler.Desktop.Views.DashboardHomeView"
             x:DataType="vm:DashboardHomeViewModel">

  <UserControl.Resources>
      <converters:BungieUrlConverter x:Key="BungieUrlConverter"/>
  </UserControl.Resources>
  
  <Grid ColumnDefinitions="*,280" x:Name="RootGrid">
    
    <!-- Left Panel: Dashboard Content -->
    <Grid RowDefinitions="Auto,Auto,*" Margin="24">
      
      <!-- Header -->
      <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,24">
        <TextBlock Text="COMMAND CENTER" FontSize="11" FontWeight="SemiBold" Foreground="Gray"/>
        <TextBlock Text="Dashboard" FontSize="32" FontWeight="Bold"/>
      </StackPanel>
      
      <!-- Guardian Cards Section -->
      <StackPanel Grid.Row="1" Spacing="16">
        <TextBlock Text="YOUR GUARDIANS" FontSize="14" FontWeight="Bold" Foreground="#AAA"/>
        
        <ItemsControl ItemsSource="{Binding Characters}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:CharacterInfo">
                    <Border Width="220" Height="80" CornerRadius="12" ClipToBounds="True" 
                            Background="#2D2D30" BorderBrush="#444" BorderThickness="1"
                            Cursor="Hand" PointerPressed="GuardianCard_PointerPressed" Tag="{Binding}">
                        <Grid>
                            <!-- Emblem Background -->
                            <asyncImageLoader:AdvancedImage Source="{Binding EmblemBackgroundUrl}" Stretch="UniformToFill" Opacity="0.6"/>
                            
                            <!-- Character Info -->
                            <StackPanel Margin="12" VerticalAlignment="Center">
                                <TextBlock Text="{Binding ClassName}" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{Binding RaceName}" FontSize="11" Foreground="#AAA"/>
                                    <TextBlock Text="â€¢" FontSize="11" Foreground="#666"/>
                                    <TextBlock Text="{Binding LightLevel}" FontSize="11" Foreground="#EBC805" FontWeight="Bold"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>
      
      <!-- Quick Actions & Notifications -->
      <Grid Grid.Row="2" RowDefinitions="Auto,*" Margin="0,24,0,0">
        
        <!-- Quick Actions -->
        <StackPanel Grid.Row="0" Spacing="12">
            <TextBlock Text="QUICK ACTIONS" FontSize="14" FontWeight="Bold" Foreground="#AAA"/>
            <WrapPanel Orientation="Horizontal">
                <Button Content="ðŸ“¦ Inventory" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸŽ¯ Loadouts" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸª Vendors" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸ† Triumphs" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="âš™ï¸ Settings" Classes="quickAction" Margin="0,0,8,8"/>
            </WrapPanel>
        </StackPanel>
        
        <!-- Notifications Placeholder -->
        <Border Grid.Row="1" Background="#1E1E20" CornerRadius="12" Margin="0,16,0,0" Padding="16">
            <StackPanel>
                <TextBlock Text="NOTIFICATIONS" FontSize="14" FontWeight="Bold" Foreground="#AAA" Margin="0,0,0,12"/>
                <TextBlock Text="No new notifications" FontSize="12" Foreground="#666"/>
            </StackPanel>
        </Border>
      </Grid>
    </Grid>
    
    <!-- Right Panel: ESTADO DEL GUARDIÃN -->
    <Border Grid.Column="1" Background="#151517" Padding="0">
      <Grid RowDefinitions="Auto,*">
      
        <!-- Guardian Emblem Header (Large) -->
        <Border Grid.Row="0" Height="180" ClipToBounds="True">
          <Grid>
            <asyncImageLoader:AdvancedImage 
                Source="{Binding SelectedCharacter.EmblemBackgroundUrl, Converter={StaticResource BungieUrlConverter}}" 
                Stretch="UniformToFill" Opacity="0.7"/>
            <Border Background="#80000000"/>
            <StackPanel VerticalAlignment="Bottom" Margin="16">
              <TextBlock Text="{Binding SelectedCharacter.ClassName, FallbackValue='GuardiÃ¡n'}" 
                         FontSize="28" FontWeight="Black" Foreground="White"/>
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding SelectedCharacter.RaceName}" FontSize="13" Foreground="#AAA"/>
                <TextBlock Text="â€¢" FontSize="13" Foreground="#666"/>
                <TextBlock Text="{Binding SelectedCharacter.GenderName}" FontSize="13" Foreground="#AAA"/>
              </StackPanel>
            </StackPanel>
          </Grid>
        </Border>
        
        <ScrollViewer Grid.Row="1">
          <StackPanel Margin="16" Spacing="16">
          
            <!-- Power Level Card -->
            <Border Background="#1E1E20" CornerRadius="10" Padding="16">
              <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                  <TextBlock Text="NIVEL DE PODER" FontSize="10" FontWeight="Bold" Foreground="#666"/>
                  <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,4,0,0">
                    <TextBlock Text="âš¡" FontSize="24" Foreground="#EBC805"/>
                    <TextBlock Text="{Binding SelectedCharacter.LightLevel, FallbackValue='0'}" 
                               FontSize="36" FontWeight="Black" Foreground="#EBC805"/>
                  </StackPanel>
                  <TextBlock Text="+15 Artefacto" FontSize="11" Foreground="#888"/>
                </StackPanel>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                  <TextBlock Text="MÃX ALCANZABLE" FontSize="9" Foreground="#555"/>
                  <TextBlock Text="{Binding MaxAchievablePower, FallbackValue='2010'}" 
                             FontSize="18" FontWeight="Bold" Foreground="#4CAF50" HorizontalAlignment="Right"/>
                </StackPanel>
              </Grid>
            </Border>
            
            <!-- Currencies -->
            <Border Background="#1E1E20" CornerRadius="10" Padding="16">
              <StackPanel Spacing="12">
                <TextBlock Text="DIVISAS" FontSize="10" FontWeight="Bold" Foreground="#666"/>
                
                <!-- Glimmer -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <Border Width="28" Height="28" CornerRadius="6" Background="#2D2D30">
                    <TextBlock Text="âœ¦" FontSize="14" Foreground="#72C6EF" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Border>
                  <TextBlock Grid.Column="1" Text="Luminosidad" FontSize="13" Foreground="White" VerticalAlignment="Center" Margin="10,0,0,0"/>
                  <TextBlock Grid.Column="2" Text="{Binding Glimmer, FallbackValue='250,000'}" FontSize="13" FontWeight="Bold" Foreground="White"/>
                </Grid>
                
                <!-- Legendary Shards -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <Border Width="28" Height="28" CornerRadius="6" Background="#2D2D30">
                    <TextBlock Text="â—†" FontSize="14" Foreground="#522F65" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Border>
                  <TextBlock Grid.Column="1" Text="Fragmentos Legendarios" FontSize="13" Foreground="White" VerticalAlignment="Center" Margin="10,0,0,0"/>
                  <TextBlock Grid.Column="2" Text="{Binding LegendaryShards, FallbackValue='5,000'}" FontSize="13" FontWeight="Bold" Foreground="#9C27B0"/>
                </Grid>
                
                <!-- Bright Dust -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <Border Width="28" Height="28" CornerRadius="6" Background="#2D2D30">
                    <TextBlock Text="âœ§" FontSize="14" Foreground="#00BCD4" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Border>
                  <TextBlock Grid.Column="1" Text="Polvo Brillante" FontSize="13" Foreground="White" VerticalAlignment="Center" Margin="10,0,0,0"/>
                  <TextBlock Grid.Column="2" Text="{Binding BrightDust, FallbackValue='12,500'}" FontSize="13" FontWeight="Bold" Foreground="#00BCD4"/>
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- Account Stats -->
            <Border Background="#1E1E20" CornerRadius="10" Padding="16" IsVisible="{Binding IsConnected}">
              <StackPanel Spacing="8">
                <TextBlock Text="ESTADÃSTICAS" FontSize="10" FontWeight="Bold" Foreground="#666"/>
                <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="Ãtems en DepÃ³sito" Foreground="#AAA" FontSize="12"/>
                  <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding VaultItemCount}" Foreground="White" FontWeight="Bold"/>
                  
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="Administrador Postal" Foreground="#AAA" FontSize="12" Margin="0,6,0,0"/>
                  <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PostmasterCount}" Foreground="White" FontWeight="Bold" Margin="0,6,0,0"/>
                  
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="ExÃ³ticos" Foreground="#AAA" FontSize="12" Margin="0,6,0,0"/>
                  <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ExoticCount}" Foreground="#F5A623" FontWeight="Bold" Margin="0,6,0,0"/>
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- Refresh Button -->
            <Button Content="ðŸ”„ Actualizar Todo" Command="{Binding RefreshInventoryCommand}"
                    HorizontalAlignment="Stretch" Padding="16,12" 
                    Background="#EBC805" Foreground="#1E1E1E" FontWeight="Bold" FontSize="13"/>
                    
          </StackPanel>
        </ScrollViewer>
        
      </Grid>
    </Border>
    
  </Grid>

  <UserControl.Styles>
    <Style Selector="Button.quickAction">
      <Setter Property="Background" Value="#2D2D30"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Padding" Value="16,10"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="FontSize" Value="12"/>
    </Style>
    <Style Selector="Button.quickAction:pointerover">
      <Setter Property="Background" Value="#3D3D40"/>
    </Style>
  </UserControl.Styles>
</UserControl>
