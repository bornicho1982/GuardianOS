<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             xmlns:vm="using:Traveler.Desktop.ViewModels"
             xmlns:services="using:Traveler.Core.Services"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Traveler.Desktop.Views.DashboardHomeView"
             x:DataType="vm:DashboardHomeViewModel">

    <ScrollViewer Margin="0,0,20,0">
        <StackPanel Spacing="24" Margin="24">
            
            <!-- GUARDIAN BANNER -->
            <Border Height="180" CornerRadius="12" ClipToBounds="True" BoxShadow="0 4 20 0 #40000000">
                <Panel>
                    <!-- Background Image -->
                    <asyncImageLoader:AdvancedImage 
                        Source="{Binding CurrentCharacter.EmblemBackgroundUrl, Converter={StaticResource BungieUrlConverter}}" 
                        Stretch="UniformToFill"/>
                    
                    <!-- Glass Overlay Gradient -->
                    <Border>
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#CC000000" Offset="0.0"/>
                                <GradientStop Color="#44000000" Offset="0.6"/>
                                <GradientStop Color="#00000000" Offset="1.0"/>
                            </LinearGradientBrush>
                        </Border.Background>
                    </Border>
                    
                    <!-- Character Info -->
                    <StackPanel VerticalAlignment="Center" Margin="40,0" Spacing="4">
                        <TextBlock Text="{Binding CurrentCharacter.ClassName}" Classes="H1" 
                                   Foreground="{StaticResource TitanGold}"/>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                             <TextBlock Text="{Binding CurrentCharacter.RaceName}" Classes="H2" Opacity="0.8"/>
                             <TextBlock Text="â€¢" Classes="H2" Opacity="0.5"/>
                             <TextBlock Text="{Binding CurrentCharacter.LightLevel}" Classes="H1" 
                                        Foreground="{StaticResource ArcBlue}" FontSize="36"/>
                             <TextBlock Text="LIGHT" VerticalAlignment="Bottom" Margin="0,0,0,6" Opacity="0.6" FontWeight="Bold"/>
                        </StackPanel>
                    </StackPanel>
                </Panel>
            </Border>

            <!-- DASHBOARD GRID -->
            <Grid ColumnDefinitions="1.5*, 1*" RowDefinitions="Auto, Auto" Margin="0,0,0,20">
                <Grid.Styles>
                    <Style Selector="Border.GlassCard">
                        <Setter Property="Margin" Value="0,0,20,20"/>
                    </Style>
                </Grid.Styles>

                <!-- LEFT COLUMN: STATUS & SYSTEMS -->
                <StackPanel Grid.Column="0" Spacing="20">
                    
                    <!-- CURRENCIES -->
                    <Border Classes="GlassCard" Margin="0,0,20,0">
                        <StackPanel Spacing="15">
                             <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="{StaticResource InventoryIcon}" Foreground="{StaticResource TitanGold}" Width="16"/>
                                <TextBlock Text="{Binding [status.currencies], Source={x:Static services:LocalizationService.Instance}}" 
                                           Classes="H2" FontSize="16" Foreground="{StaticResource TitanGold}"/>
                            </StackPanel>
                            
                            <ItemsControl ItemsSource="{Binding Currencies}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#15FFFFFF" CornerRadius="8" Padding="12,8" Margin="0,0,10,10" 
                                                BorderBrush="#20FFFFFF" BorderThickness="1">
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <asyncImageLoader:AdvancedImage Source="{Binding Icon, Converter={StaticResource BungieUrlConverter}}" Width="24" Height="24"/>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Quantity}" FontWeight="Bold" Foreground="White"/>
                                                    <TextBlock Text="{Binding Name}" FontSize="12" Opacity="0.7"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                    
                    <!-- VAULT STATUS -->
                    <Border Classes="GlassCard" Margin="0,0,20,0">
                        <StackPanel Spacing="15">
                             <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="{StaticResource InventoryIcon}" Foreground="{StaticResource TitanGold}" Width="16"/>
                                <TextBlock Text="{Binding [status.vaultItems], Source={x:Static services:LocalizationService.Instance}}" 
                                           Classes="H2" FontSize="16" Foreground="{StaticResource TitanGold}"/>
                            </StackPanel>

                            <Grid ColumnDefinitions="*, Auto">
                                <TextBlock Text="Capacity Usage" Opacity="0.7"/>
                                <TextBlock Grid.Column="1" Text="{Binding VaultSpaceText}" Foreground="{Binding VaultSpaceColor}" FontWeight="Bold"/>
                            </Grid>
                            
                            <ProgressBar Value="{Binding VaultSpaceUsed}" Maximum="{Binding VaultSpaceTotal}" Height="6" 
                                         Foreground="{Binding VaultSpaceColor}" Background="#22FFFFFF" CornerRadius="3"/>
                            
                            <TextBlock Text="Tip: Use 'Organization Mode' to clean up duplicates." FontSize="12" Opacity="0.5" FontStyle="Italic"/>
                        </StackPanel>
                    </Border>
                    
                </StackPanel>

                <!-- RIGHT COLUMN: ACTIONS & CONNECTIONS -->
                <StackPanel Grid.Column="1" Spacing="20">
                    
                    <!-- CONNECTION STATUS -->
                    <Border Classes="GlassCard">
                        <StackPanel Spacing="20">
                            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                                <Ellipse Width="8" Height="8" Fill="{Binding ConnectionStatusColor}"/>
                                <TextBlock Text="{Binding ConnectionStatus}" FontWeight="SemiBold" Foreground="{Binding ConnectionStatusColor}"/>
                            </StackPanel>
                            
                            <Button Classes="Premium" Content="{Binding ConnectionButtonText}" Command="{Binding ToggleConnectionCommand}" HorizontalAlignment="Stretch"/>
                            <Button Classes="Premium" Content="Force Manifest Update" Command="{Binding RefreshInventoryCommand}" HorizontalAlignment="Stretch" Opacity="0.8"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- QUICK ACTIONS (Placeholders) -->
                    <Border Classes="GlassCard">
                        <StackPanel Spacing="15">
                            <TextBlock Text="QUICK ACTIONS" Classes="H2" FontSize="16" Foreground="{StaticResource ArcBlue}"/>
                            
                            <UniformGrid Columns="2" Rows="2">
                                <Button Classes="Premium" Content="Max Power" Margin="0,0,5,5" IsEnabled="False"/>
                                <Button Classes="Premium" Content="Farming Mode" Margin="5,0,0,5" IsEnabled="False"/>
                                <Button Classes="Premium" Content="Postmaster" Margin="0,5,5,0" IsEnabled="False"/>
                                <Button Classes="Premium" Content="Loadouts" Margin="5,5,0,0" IsEnabled="False"/>
                            </UniformGrid>
                        </StackPanel>
                    </Border>
                </StackPanel>
                
            </Grid>
        </StackPanel>
    </ScrollViewer>
</UserControl>
