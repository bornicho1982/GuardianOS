<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Traveler.Desktop.ViewModels"
             xmlns:models="using:Traveler.Core.Models"
             xmlns:asyncImageLoader="using:AsyncImageLoader"
             xmlns:converters="using:Traveler.Desktop.Converters"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="Traveler.Desktop.Views.DashboardHomeView"
             x:DataType="vm:DashboardHomeViewModel">

  <UserControl.Resources>
      <converters:BungieUrlConverter x:Key="BungieUrlConverter"/>
  </UserControl.Resources>
  
  <Grid ColumnDefinitions="*,280" x:Name="RootGrid">
    
    <!-- Left Panel: Dashboard Content -->
    <Grid RowDefinitions="Auto,Auto,*" Margin="24">
      
      <!-- Header -->
      <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,24">
        <TextBlock Text="COMMAND CENTER" FontSize="11" FontWeight="SemiBold" Foreground="Gray"/>
        <TextBlock Text="Dashboard" FontSize="32" FontWeight="Bold"/>
      </StackPanel>
      
      <!-- Guardian Cards Section -->
      <StackPanel Grid.Row="1" Spacing="16">
        <TextBlock Text="YOUR GUARDIANS" FontSize="14" FontWeight="Bold" Foreground="#AAA"/>
        
        <ItemsControl ItemsSource="{Binding Characters}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:CharacterInfo">
                    <Border Width="220" Height="80" CornerRadius="12" ClipToBounds="True" 
                            Background="#2D2D30" BorderBrush="#444" BorderThickness="1"
                            Cursor="Hand" PointerPressed="GuardianCard_PointerPressed" Tag="{Binding}">
                        <Grid>
                            <!-- Emblem Background -->
                            <asyncImageLoader:AdvancedImage Source="{Binding EmblemBackgroundUrl}" Stretch="UniformToFill" Opacity="0.6"/>
                            
                            <!-- Character Info -->
                            <StackPanel Margin="12" VerticalAlignment="Center">
                                <TextBlock Text="{Binding ClassName}" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{Binding RaceName}" FontSize="11" Foreground="#AAA"/>
                                    <TextBlock Text="â€¢" FontSize="11" Foreground="#666"/>
                                    <TextBlock Text="{Binding LightLevel}" FontSize="11" Foreground="#EBC805" FontWeight="Bold"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>
      
      <!-- Quick Actions & Notifications -->
      <Grid Grid.Row="2" RowDefinitions="Auto,*" Margin="0,24,0,0">
        
        <!-- Quick Actions -->
        <StackPanel Grid.Row="0" Spacing="12">
            <TextBlock Text="QUICK ACTIONS" FontSize="14" FontWeight="Bold" Foreground="#AAA"/>
            <WrapPanel Orientation="Horizontal">
                <Button Content="ðŸ“¦ Inventory" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸŽ¯ Loadouts" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸª Vendors" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="ðŸ† Triumphs" Classes="quickAction" Margin="0,0,8,8"/>
                <Button Content="âš™ï¸ Settings" Classes="quickAction" Margin="0,0,8,8"/>
            </WrapPanel>
        </StackPanel>
        
        <!-- Notifications Placeholder -->
        <Border Grid.Row="1" Background="#1E1E20" CornerRadius="12" Margin="0,16,0,0" Padding="16">
            <StackPanel>
                <TextBlock Text="NOTIFICATIONS" FontSize="14" FontWeight="Bold" Foreground="#AAA" Margin="0,0,0,12"/>
                <TextBlock Text="No new notifications" FontSize="12" Foreground="#666"/>
            </StackPanel>
        </Border>
      </Grid>
    </Grid>
    
    <!-- Right Panel: Account Stats -->
    <Border Grid.Column="1" Background="#1E1E20" Padding="16">
      <StackPanel Spacing="16">
        
        <!-- Connection Status -->
        <Border Background="#2D2D30" CornerRadius="8" Padding="12">
          <Grid ColumnDefinitions="Auto,*,Auto">
            <Ellipse Grid.Column="0" Width="10" Height="10" 
                     Fill="{Binding ConnectionStatusColor}"/>
            <TextBlock Grid.Column="1" Text="{Binding ConnectionStatus}" 
                       Margin="8,0" VerticalAlignment="Center" FontSize="12"/>
            <Button Grid.Column="2" Content="{Binding ConnectionButtonText}" 
                    Command="{Binding ToggleConnectionCommand}"
                    FontSize="11" Padding="12,6"/>
          </Grid>
        </Border>
        
        <!-- Account Stats -->
        <StackPanel Spacing="8" IsVisible="{Binding IsConnected}">
          <TextBlock Text="ACCOUNT STATS" FontSize="11" FontWeight="SemiBold" Foreground="Gray"/>
          
          <Border Background="#2D2D30" CornerRadius="8" Padding="12">
            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
              <TextBlock Grid.Row="0" Grid.Column="0" Text="Vault Items" Foreground="#AAA" FontSize="12"/>
              <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding VaultItemCount}" Foreground="White" FontWeight="Bold"/>
              
              <TextBlock Grid.Row="1" Grid.Column="0" Text="Postmaster" Foreground="#AAA" FontSize="12" Margin="0,4,0,0"/>
              <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PostmasterCount}" Foreground="White" FontWeight="Bold" Margin="0,4,0,0"/>
              
              <TextBlock Grid.Row="2" Grid.Column="0" Text="Exotic Items" Foreground="#AAA" FontSize="12" Margin="0,4,0,0"/>
              <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ExoticCount}" Foreground="#F5A623" FontWeight="Bold" Margin="0,4,0,0"/>
            </Grid>
          </Border>
          
          <Button Content="ðŸ”„ Refresh All" Command="{Binding RefreshInventoryCommand}"
                  HorizontalAlignment="Stretch" Padding="12,8" FontSize="12"/>
        </StackPanel>
        
      </StackPanel>
    </Border>
    
  </Grid>

  <UserControl.Styles>
    <Style Selector="Button.quickAction">
      <Setter Property="Background" Value="#2D2D30"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Padding" Value="16,10"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="FontSize" Value="12"/>
    </Style>
    <Style Selector="Button.quickAction:pointerover">
      <Setter Property="Background" Value="#3D3D40"/>
    </Style>
  </UserControl.Styles>
</UserControl>
