<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Traveler.Desktop.ViewModels"
        xmlns:converters="using:Traveler.Desktop.Converters"
        xmlns:asyncImageLoader="using:AsyncImageLoader"
        x:Class="Traveler.Desktop.Views.GuardianDetailWindow"
        Title="Guardian Detail"
        Width="1024" Height="700"
        WindowStartupLocation="CenterOwner"
        Background="#1A1A1A"
        ExtendClientAreaToDecorationsHint="True">

    <Window.Resources>
        <converters:BungieUrlConverter x:Key="BungieUrlConverter"/>
        <converters:BoolToBrushConverter x:Key="BoolToBrushConverter"/>
        <converters:MasterworkBorderConverter x:Key="MasterworkBorderConverter"/>
        <converters:BoolToThicknessConverter x:Key="BoolToThicknessConverter"/>
        <converters:TierBackgroundConverter x:Key="TierBackgroundConverter"/>
    </Window.Resources>

    <Grid>
        <!-- Dynamic Element Glow Background -->
        <Border x:Name="ElementGlow" Opacity="0.4">
            <Border.Background>
                <RadialGradientBrush Center="0.5,0.6" GradientOrigin="0.5,1" RadiusX="0.8" RadiusY="0.8">
                    <GradientStop Color="{Binding ElementGlowColor}" Offset="0"/>
                    <GradientStop Color="Transparent" Offset="1"/>
                </RadialGradientBrush>
            </Border.Background>
        </Border>

        <Grid RowDefinitions="Auto,*">
            <!-- Top: Emblem Banner -->
            <Border Grid.Row="0" Height="120" ClipToBounds="True">
                <asyncImageLoader:AdvancedImage Source="{Binding Character.EmblemBackgroundUrl}" Stretch="UniformToFill" Opacity="0.9"/>
            </Border>
            <StackPanel Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="20,0">
                <TextBlock Text="{Binding Character.ClassName}" FontSize="36" FontWeight="Bold" Foreground="White"/>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="{Binding Character.LightLevel}" FontSize="20" Foreground="#EBC805" FontWeight="Bold"/>
                    <TextBlock Text="POWER" FontSize="12" Foreground="#AAA" VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- Main Content: Hybrid Dashboard (WebView 2/3 + Stats Panel 1/3) -->
            <Grid Grid.Row="1" ColumnDefinitions="2*,*" Margin="0">

                <!-- LEFT: 3D Guardian Viewer (WebView) -->
                <Grid Grid.Column="0">
                    <!-- Loading overlay (shown while WebView initializes) -->
                    <Border x:Name="LoadingOverlay" 
                            Background="#0D0D0D" 
                            ZIndex="100"
                            IsVisible="True">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                            <TextBlock Text="ðŸŽ® Loading 3D Viewer..." 
                                       Foreground="#888" FontSize="18" FontWeight="SemiBold"
                                       HorizontalAlignment="Center"/>
                            <ProgressBar IsIndeterminate="True" 
                                         Width="200" Height="4" 
                                         Foreground="#4A9EFF"/>
                            <TextBlock Text="{Binding Target3DUrl}" 
                                       Foreground="#444" FontSize="9" 
                                       HorizontalAlignment="Center"
                                       TextTrimming="CharacterEllipsis" MaxWidth="350"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- WebView Container (CefGlue will be added programmatically) -->
                    <Border x:Name="WebViewContainer" 
                            Background="#0D0D0D"/>
                </Grid>

                <!-- RIGHT: Glassmorphism Stats Panel -->
                <Border Grid.Column="1" Margin="0" ClipToBounds="True">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#CC1A1A2E" Offset="0"/>
                            <GradientStop Color="#CC0D0D1A" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    
                    <!-- Glassmorphism blur effect overlay -->
                    <Grid>
                        <!-- Semi-transparent overlay for glass effect -->
                        <Border Background="#1A1A1A" Opacity="0.85"/>
                        
                        <!-- Content -->
                        <ScrollViewer Padding="20" VerticalScrollBarVisibility="Auto">
                            <StackPanel Spacing="20">
                                
                                <!-- Power Level Header -->
                                <Border Background="#2D2D35" CornerRadius="12" Padding="16">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="POWER LEVEL" FontSize="11" Foreground="#666" 
                                                   HorizontalAlignment="Center" FontWeight="SemiBold" 
                                                   LetterSpacing="2"/>
                                        <TextBlock Text="{Binding Character.LightLevel}" 
                                                   FontSize="48" FontWeight="Bold" Foreground="#EBC805"
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding Character.ClassName}" 
                                                   FontSize="14" Foreground="#888" 
                                                   HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Stats Section -->
                                <TextBlock Text="CHARACTER STATS" FontSize="11" Foreground="#666" 
                                           FontWeight="SemiBold" LetterSpacing="2" Margin="0,8,0,0"/>
                                
                                <!-- Mobility -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding MobilityIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Mobility" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalMobility}" FontSize="16" FontWeight="Bold" Foreground="#79B5E8"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalMobility}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#79B5E8" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Resilience -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding ResilienceIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Resilience" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalResilience}" FontSize="16" FontWeight="Bold" Foreground="#E85D5D"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalResilience}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#E85D5D" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Recovery -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding RecoveryIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Recovery" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalRecovery}" FontSize="16" FontWeight="Bold" Foreground="#F5A623"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalRecovery}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#F5A623" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Discipline -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding DisciplineIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Discipline" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalDiscipline}" FontSize="16" FontWeight="Bold" Foreground="#5BD998"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalDiscipline}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#5BD998" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Intellect -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding IntellectIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Intellect" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalIntellect}" FontSize="16" FontWeight="Bold" Foreground="#A75ED3"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalIntellect}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#A75ED3" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Strength -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <Grid RowDefinitions="Auto,Auto">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <asyncImageLoader:AdvancedImage Source="{Binding StrengthIcon, Converter={StaticResource BungieUrlConverter}}" 
                                                                            Width="20" Height="20" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="Strength" FontSize="13" Foreground="#AAA" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{Binding TotalStrength}" FontSize="16" FontWeight="Bold" Foreground="#4FC4E8"/>
                                        </Grid>
                                        <ProgressBar Grid.Row="1" Value="{Binding TotalStrength}" Maximum="100" 
                                                     Height="4" Margin="0,8,0,0" Foreground="#4FC4E8" Background="#1A1A1A"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Equipped Loadout Section -->
                                <TextBlock Text="EQUIPPED LOADOUT" FontSize="11" Foreground="#666" 
                                           FontWeight="SemiBold" LetterSpacing="2" Margin="0,16,0,0"/>
                                
                                <!-- Weapons Row -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="WEAPONS" FontSize="10" Foreground="#555" Margin="0,0,0,8"/>
                                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                            <!-- Kinetic -->
                                            <Border Width="50" Height="50" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedKinetic.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- Energy -->
                                            <Border Width="50" Height="50" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedEnergy.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- Power -->
                                            <Border Width="50" Height="50" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedPower.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Armor Row -->
                                <Border Background="#2A2A32" CornerRadius="8" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="ARMOR" FontSize="10" Foreground="#555" Margin="0,0,0,8"/>
                                        <WrapPanel HorizontalAlignment="Center">
                                            <!-- Helmet -->
                                            <Border Width="44" Height="44" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1" Margin="3">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedHelmet.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- Gauntlets -->
                                            <Border Width="44" Height="44" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1" Margin="3">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedGauntlets.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- Chest -->
                                            <Border Width="44" Height="44" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1" Margin="3">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedChest.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- Legs -->
                                            <Border Width="44" Height="44" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1" Margin="3">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedLegs.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                            <!-- ClassItem -->
                                            <Border Width="44" Height="44" CornerRadius="6" Background="#1A1A1A" ClipToBounds="True"
                                                    BorderBrush="#3A3A3A" BorderThickness="1" Margin="3">
                                                <asyncImageLoader:AdvancedImage Source="{Binding EquippedClassItem.IconUrl}" Stretch="UniformToFill"/>
                                            </Border>
                                        </WrapPanel>
                                    </StackPanel>
                                </Border>
                                
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>

        </Grid>
    </Grid>
</Window>
