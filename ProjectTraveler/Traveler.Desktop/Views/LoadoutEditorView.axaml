<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Traveler.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Traveler.Desktop.Views.LoadoutEditorView"
             x:DataType="vm:LoadoutEditorViewModel">
  
  <Grid RowDefinitions="Auto, *, Auto" Margin="20">
    
    <!-- Header -->
    <StackPanel Grid.Row="0" Spacing="10" Margin="0,0,0,20">
      <TextBlock Text="Loadout Editor" FontSize="28" FontWeight="Bold"/>
      <TextBox Watermark="Loadout Name" Text="{Binding LoadoutName}" MaxWidth="300" HorizontalAlignment="Left"/>
    </StackPanel>
    
    <!-- Main Content -->
    <Grid Grid.Row="1" ColumnDefinitions="*, 2, *">
      
      <!-- Left Panel: Constraints -->
      <Border Grid.Column="0" Background="#2D2D30" CornerRadius="8" Padding="16">
        <ScrollViewer>
          <StackPanel Spacing="16">
            
            <TextBlock Text="STAT CONSTRAINTS (0-200)" FontWeight="SemiBold" FontSize="14" Foreground="Gray"/>
            
            <!-- Mobility -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Mobility" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinMobility}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinMobility}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Resilience -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Resilience" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinResilience}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinResilience}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Recovery -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Recovery" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinRecovery}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinRecovery}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Discipline -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Discipline" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinDiscipline}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinDiscipline}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Intellect -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Intellect" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinIntellect}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinIntellect}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <!-- Strength -->
            <Grid ColumnDefinitions="100, *, 50">
              <TextBlock Text="Strength" VerticalAlignment="Center"/>
              <Slider Grid.Column="1" Minimum="0" Maximum="200" Value="{Binding MinStrength}" TickFrequency="10"/>
              <TextBlock Grid.Column="2" Text="{Binding MinStrength}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
            </Grid>
            
            <Separator Margin="0,10"/>
            
            <TextBlock Text="LOCK EXOTIC" FontWeight="SemiBold" FontSize="14" Foreground="Gray"/>
            <ComboBox ItemsSource="{Binding AvailableExotics}" 
                      SelectedItem="{Binding LockedExotic}"
                      PlaceholderText="No exotic locked"
                      HorizontalAlignment="Stretch">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Name}"/>
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            
            <Separator Margin="0,10"/>
            
            <TextBlock Text="AI ASSISTANT" FontWeight="SemiBold" FontSize="14" Foreground="Gray"/>
            <TextBox Watermark="Describe your build in natural language..." 
                     Text="{Binding NaturalLanguageQuery}"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     MinHeight="80"/>
            <Button Content="Ask AI" Command="{Binding AskAiCommand}" HorizontalAlignment="Left"/>
            
          </StackPanel>
        </ScrollViewer>
      </Border>
      
      <GridSplitter Grid.Column="1" ResizeDirection="Columns" Background="Transparent"/>
      
      <!-- Right Panel: Results -->
      <Border Grid.Column="2" Background="#2D2D30" CornerRadius="8" Padding="16">
        <Grid RowDefinitions="Auto, *, Auto, Auto">
          
          <TextBlock Grid.Row="0" Text="OPTIMIZED LOADOUT" FontWeight="SemiBold" FontSize="14" Foreground="Gray" Margin="0,0,0,10"/>
          
          <!-- Selected Items -->
          <ListBox Grid.Row="1" ItemsSource="{Binding OptimizedItems}" Background="Transparent">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Background="#1E1E1E" CornerRadius="4" Padding="10" Margin="0,2">
                  <Grid ColumnDefinitions="*, Auto">
                    <StackPanel>
                      <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                      <TextBlock Text="{Binding ItemType}" FontSize="12" Foreground="Gray"/>
                    </StackPanel>
                    <TextBlock Grid.Column="1" Text="{Binding PowerLevel}" VerticalAlignment="Center" Foreground="Yellow"/>
                  </Grid>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
          
          <!-- Tuning Recommendations -->
          <ItemsControl Grid.Row="2" ItemsSource="{Binding TuningRecommendations}" Margin="0,10">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding}" FontSize="11" Foreground="Cyan"/>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          
          <!-- AI Response -->
          <Border Grid.Row="3" Background="#1A1A1A" CornerRadius="4" Padding="10" Margin="0,10,0,0">
            <TextBlock Text="{Binding AiResponse}" TextWrapping="Wrap" FontStyle="Italic"/>
          </Border>
          
        </Grid>
      </Border>
      
    </Grid>
    
    <!-- Footer Actions -->
    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" Margin="0,20,0,0">
      <Button Content="Run Optimizer" Command="{Binding RunOptimizerCommand}" Classes="accent"/>
      <Button Content="Save Loadout" Command="{Binding SaveLoadoutCommand}"/>
    </StackPanel>
    
  </Grid>
</UserControl>
